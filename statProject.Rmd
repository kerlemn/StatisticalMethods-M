---
title: "R Notebook"
output:
  pdf_document: default
  html_notebook: default
---

```{r}
library(ggplot2)
library(GGally)
library(dplyr)
library(tidyr)
library(dbplyr)
library(viridis)
library(ggcorrplot)
library(MASS)
library(arm)
library(mgcv)
#ZIP.Code: postal code
#CD.Account: certificate deposit, a type of savings account offered by banks and credit unions.

#Importing the dataset
data = read.csv("Bank_loan.csv", header = T)

#removing ID and ZIP.CODE
data = data %>%
  dplyr::select(-c(ID, ZIP.Code))

#making categorical variables factors
data = data %>%
  mutate(across(c(Family, Education, Personal.Loan, Securities.Account, CD.Account, Online, CreditCard ),                           as.factor))

#Bar plot response variable 
data %>%
  ggplot(aes(x = Personal.Loan, y = after_stat(count / sum(count)))) +
  geom_bar(fill = "skyblue", color = "black") +
  scale_x_discrete(labels = c("No", "Yes")) +
  xlab("Personal Loan") + ylab("Relative Frequency")

#Imbalance ratio
IR = sum(data$Personal.Loan == 0) / sum(data$Personal.Loan == 1)
IR

#Histogram numerical variable
data %>%
  pivot_longer(cols = where(is.numeric)) %>%
  ggplot(aes(x = value)) +
  geom_histogram(bins = 15, fill = "skyblue", color = "black") +
  facet_wrap(~ name, scales = "free") + xlab("") + ylab("")
  theme_grey() 

#Bar plot categotical variables
data %>%
  dplyr::select(-Personal.Loan) %>%
  pivot_longer(cols = where(is.factor)) %>%
  ggplot(aes(x = value)) +
  geom_bar(fill = "skyblue", color = "black") +
  facet_wrap(~ name, scales = "free") +
  xlab("") + ylab("")
```


```{r}
#relations with numerical variables
#Box plots
data %>% 
  pivot_longer(cols = where(is.numeric)) %>%
  ggplot(aes(x = Personal.Loan, y = value, fill = Personal.Loan)) +
  geom_boxplot() +
  facet_wrap(~ name, scales = "free")  +
  scale_x_discrete(labels = c("No", "Yes")) +
  labs(x = "Personal Loan", y = "", fill = "Personal Loan") +
  theme(legend.position = "none")

#Correlation matrix
data %>%
  dplyr::select(where(is.numeric)) %>%
  cor() %>%
  ggcorrplot( ggtheme = theme_classic(), outline.color = "black")

#removing experience from the dataset
data = data %>%
  dplyr::select(-Experience)

```


```{r}
#relations with categorical variables
data %>%
  pivot_longer(cols = c("CD.Account","Education", "Family", "Securities.Account", "Online", "CreditCard")) %>%
  group_by(name, value, Personal.Loan) %>%
  summarise(Count = n(), .groups = 'drop') %>%
  group_by(name, value) %>%
  mutate(Freq = Count / sum(Count)) %>%
  ggplot(aes(x = value, y = Freq, fill = Personal.Loan)) +
  geom_bar(stat = "identity", position = "dodge", color = "black") +
  facet_wrap(~ name, scales = "free_x") +
  scale_fill_discrete(labels = c("0" = "No", "1" = "Yes")) +
  labs(y = "Frequency") + xlab("")
```


```{r}
#balancing original dataset with resempling
set.seed(123)
minority_data <- data[data$Personal.Loan == 1, ]
majority_data <- data[data$Personal.Loan == 0, ]

#Dataset balanced with simple oversampling
data_oversampled = minority_data[sample(1:nrow(minority_data), size = nrow(majority_data), replace = TRUE), ] %>%
  rbind(., majority_data)

#Dataset balanced by replicating the subset of the less frequent class 10 times
data_oversampled2 = rep(1:nrow(minority_data), each = 10) %>%
  lapply(function(x) minority_data[x, ]) %>%
  do.call(rbind, .) %>% rbind(., majority_data)

```




